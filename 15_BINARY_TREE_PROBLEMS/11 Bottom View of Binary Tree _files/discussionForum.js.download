var params={};params.discussionPage=0;params.iId="all";params.iType="problems";params.commentSlug="";params.page=1;params.solvedFilter=2;params.searchQuery="";params.sortBy="Newest";params.doubtAssistance=0;params.pType="";params.pId="";var sendAjax=1;var openDiscussionPage=0;var emptyAllResponses=0;function showErrorMsg(msg){$("#gfg-snackbar").text(msg);$("#gfg-snackbar").addClass("show");setTimeout(function(){$("#gfg-snackbar").removeClass("show")},3e3)}function shortenDescription(className){$(className).each(function(event){var max_length=250;if($(this).html().length>max_length&&!$(this).find(".short_text").length){var content=$(this).html();var short_content=content;short_content=short_content.substr(0,max_length);$(this).html('<div class="short_text">'+short_content+"</div>");$(this).append('<a href="#" class="read_more" style="color:darkgray;text-align:center;text-decoration:none;display:block;font-size:13px;">Read More</a>');$(this).append('<div class="complete_text" style="display:none;">'+content+"</div>")}})}function selectRateIcon(target){for(var i=1;i<=5;i++){$("#rating"+i).hide();$("#ratingIcon"+i).css("color","#333").attr("value","0")}$(target).css("color","#418c56").attr("value","1")}function getFeedbackForModerator(moderatorHandle){$("#moderatorFeedbackModal").show()}$("body").on("click","a.read_more",function(event){event.preventDefault();$(this).parent().find(".short_text").hide();$(this).hide();$(this).parent().find(".complete_text").show()});function fetchDiscussionHtml(){if(!sendAjax)return;sendAjax=0;if(Array.isArray(params.iId)){params.iId=params.iId.join()}if(emptyAllResponses==1){allResponses=[]}var data=params;data["requestType"]="fetchAllCommentsOnItem";var tempId=params.iId;$.ajax({type:"GET",url:"/ajax/commentActions.php",data:data,dataType:"json",success:function(response){if(response.hasOwnProperty("data")&&response.data!=""){$(".d-unpicked").html(" - "+response.data.unpicked);$(".d-unresolved").html(" - "+response.data.unresolved);$(".d-resolved").html(" - "+response.data.resolved);$(".d-resolved-auto").html(" - "+response.data.auto_resolved);$(".d-pending-client").html(" - "+response.data.pending_client_side);$(".d-pending-ta").html(" - "+response.data.pending_ta_side)}if(response.hasOwnProperty("data")&&response.data!=""&&response.data.TaDoubtPickedData!=""){$("#no-doubt-picked").remove();var html="";response.data.TaDoubtPickedData.forEach(TA=>{var userImageLink="https://media.geeksforgeeks.org/auth/";if(TA["profile_img_id"]!=null&&TA["profile_img_id"]!=""){userImageLink+="profile/"+TA["profile_img_id"]}else{userImageLink+="avatar.png"}html+='<tr><td style="display:flex; border:none;">';html+='<img src="'+userImageLink+'" style="width:25px;height:25px;border-radius:50%;background-size:cover;">&ensp;';html+='<a href = "https://auth.geeksforgeeks.org/user/'+TA["handle"]+'" target="_blank" rel="noopener noreferrer" style="text-align:center;">'+TA["handle"]+'</a></td><td style="text-align:center; border:none;"><button type="button" class="btn-link taDoubtsModal" data-toggle="modal" data-target="#taModal" data-handle="'+TA["handle"]+'">'+TA["picked"]+"</button></td></tr>"});$("#ta-doubt-picked-count").append(html)}$("#forum-discussion").html(response.html);$("#replies-section").css("display","block");if(typeof $("#replies-section")!="undefined"&&$("#replies-section")!=null){if($("#replies-section").html()!=undefined&&$("#replies-section").html().length==0){$("#replies-section").css("display","none")}else{$("#replies-section").animate({scrollTop:1e4},"slow")}}$("#discussion-loader").remove();$(".search_content").val(params.searchQuery);$("#reply-text").ckeditor({height:"75px",customConfig:"/ckeditor/custom_config-1.0.js?v=1.2",extraPlugins:"codesnippet,uploadimage,xml,textmatch,ajax,textwatcher,autocomplete,mentions,widget,lineutils,dialog,clipboard,mathjax"});$("#discussion-text").ckeditor({height:"150px",customConfig:"/ckeditor/custom_config-1.0.js?v=1.2",extraPlugins:"codesnippet,uploadimage,xml,textmatch,ajax,textwatcher,autocomplete,mentions,widget,lineutils,dialog,clipboard,mathjax"});shortenDescription(".discussion-desc");shortenDescription(".reply-desc");MathJax.Hub.Queue(["Typeset",MathJax.Hub]);$(".reply-desc > p img").addClass("img-responsive");if(typeof emailPath!=="undefined"&&emailPath===true){$(".markAsSolved").click()}},complete:function(){sendAjax=1;params.iId=tempId}});$("#forum-discussion").html("");$("<div id='discussion-loader' style='margin:10px auto;width:50px;height:50px;border-radius:50%;'></div>").insertAfter("#forum-discussion");$("#discussion-loader").css("background",'url("https://media.geeksforgeeks.org/img-practice/loader.gif") no-repeat center center rgba(0,0,0,0.25)');$("#discussion-loader").css("background-color","#fff")}$(document).ready(function(){var cssId="doubtSupportCss";if(!document.getElementById(cssId)){var head=document.getElementsByTagName("head")[0];var link=document.createElement("link");link.id=cssId;link.rel="stylesheet";link.type="text/css";link.href="/css/comment.css?v=1.8";link.media="all";head.appendChild(link)}var script_tag=document.getElementById("forum-script");var query=script_tag.src.replace(/^[^\?]+\??/,"");var vars=query.split("&");var args={};for(var i=0;i<vars.length;i++){var pair=vars[i].split("=");args[pair[0]]=pair[1]}params.iId=args["itemId"];params.iType=args["type"];params.commentSlug=args["commentSlug"];params.discussionPage=args["discussionPage"]===undefined?0:1;params.doubtAssistance=args["doubtAssistance"]===undefined||args["doubtAssistance"]==0?0:1;params.solvedFilter=args["solvedFilter"]===undefined?2:args["solvedFilter"];params.userHasAccessToDoubtAssistance=args["userHasAccessToDoubtAssistance"]===undefined?0:args["userHasAccessToDoubtAssistance"];fetchDiscussionHtml();$("body").on("click",".pagination>li>a",function(e){e.preventDefault();params.page=$(this).text();fetchDiscussionHtml()});$("body").on("click",".discussion-title.openComment",function(e){params.commentSlug=$(this).parents(".discussion-post").attr("data-slug");if(params.commentSlug==""){showErrorMsg("Invalid Request");return}params.pId=params.iId;params.iId=$(this).parents(".discussion-post").attr("item-id");params.pType=params.iType;params.iType="discussion";params.page=1;var disId=$(this).parents(".discussion-post").attr("discussion");openDiscussionPage=disId;fetchDiscussionHtml()});$("body").on("click",".discussion-list",function(e){params.commentSlug="";params.iId=params.pId;params.pId="";params.iType=params.pType;params.pType="";openDiscussionPage=0;fetchDiscussionHtml()});$(".discussion-type.selectpicker").on("change",function(){changeDiscussionItems();params.commentSlug="";params.iId="all";params.iType=$(this).val();if(params.iType=="batch"){$(".discussion-category").parent().css("display","block");$(".discussion-category.selectpicker").val("category-all").trigger("change")}else{$(".discussion-category").parent().css("display","none")}params.solvedFilter=$(".discussion-status.selectpicker").val();fetchDiscussionHtml()});$(".discussion-slug").on("hide.bs.select",function(){params.commentSlug="";params.iType=$(".discussion-category.selectpicker").val();params.iId=$(this).val();params.page=1;if(params.iId==null){params.iId="all"}params.solvedFilter=$(".discussion-status.selectpicker").val();fetchDiscussionHtml()});$(".discussion-category.selectpicker").on("change",function(){params.commentSlug="";params.iId=$(".discussion-slug.selectpicker").val();if(params.iId==null){params.iId="all"}params.page=1;params.iType=$(this).val();params.solvedFilter=$(".discussion-status.selectpicker").val();fetchDiscussionHtml()});$(".discussion-status").on("change",function(){params.commentSlug="";params.iType=$(".discussion-category.selectpicker").val();params.iId=$(".discussion-slug.selectpicker").val();if(params.iId==null){params.iId="all"}if(params.iType==""){params.iType="problems"}params.page=1;params.solvedFilter=$(".discussion-status.selectpicker").val();fetchDiscussionHtml()});$(this).keydown(function(e){if($(".search_content:focus")&&e.keyCode===13){$(".discussion-search").click()}if(e.keyCode==27){$("#moderatorFeedbackModal").hide()}});$("body").on("click",".discussion-search",function(){params.page=1;params.searchQuery=$(".search_content").val();fetchDiscussionHtml()});$("body").on("click","#btnPostDiscussion",function(e){e.preventDefault();if($("#discussion-title").val()==""){showErrorMsg("Description title cannot be blank.");$("#discussion-title").closest(".form-group").addClass("has-error");return}if($("#discussion-text").val()==""){showErrorMsg("Description text cannot be blank.");$("#discussion-text").closest(".form-group").addClass("has-error");return}$("#btnPostDiscussion").text("Submitting..");var data=params;data["requestType"]="addNewComment";data["title"]=$("#discussion-title").val();data["description"]=$("#discussion-text").val();data["ctoken"]=$("#ctoken").val();data["utoken"]=$("#utoken").text();if(pageSource=="problems"){data["batchId"]=batch_id!=undefined?batch_id:"";data["trackId"]=track_id!=undefined?track_id:""}$.ajax({type:"POST",url:"/ajax/commentActions.php",data:data,dataType:"text",success:function(data){var response=JSON.parse(data);if(response.status=="success"){$("#discussion-forum").modal("hide");$(".modal-backdrop").remove();$("body").removeClass("modal-open");params.page=1;fetchDiscussionHtml();sendMessageToSocket("submitDoubt")}else{showErrorMsg(response.message)}},error:function(response){console.log("Error")}})});$("body").on("click",".sortby-menuitem",function(){$("#sortby-menu").find("span:eq(1)").html($(this).text());params.sortBy=$(this).text();fetchDiscussionHtml()});$("body").on("click",".comment-id-link",function(){params.iId=$(this).attr("id");params.iType="batch";fetchDiscussionHtml()});$("body").on("click",".editDiscussion",function(){if($(this).parents(".discussion-post").find(".comment-desc").find("#edit-discussion-text").length)return;$(this).closest(".discussion-post").find(".comment-desc").find(".math-tex").each(function(index){$(this).html("\\("+$(this).find("script").html()+"\\)")});var div=$(this).parents(".discussion-post").find(".comment-desc");var divHtml=$(div).html();var html='<div class="form-group"><a id="btnEditDiscussionClose" style="margin-right:5px;" class="btn btn-default btn-sm">Close</a><a id="btnEditDiscussion" class="btn btn-primary btn-sm">Edit</a></div>';var editableText=$("<textarea/>").attr({cols:"20",id:"edit-discussion-text"});editableText.val($(div).find(".complete_text").length?$(div).find(".complete_text").html():$(div).html());$(div).html(editableText);$(div).append(html);$(editableText).ckeditor({height:"150px",customConfig:"/ckeditor/custom_config-1.0.js?v=1.2",extraPlugins:"codesnippet,uploadimage,xml,textmatch,ajax,textwatcher,autocomplete,mentions,widget,lineutils,dialog,clipboard,mathjax"});document.getElementById("btnEditDiscussionClose").addEventListener("click",function(event){$(div).html(divHtml);MathJax.Hub.Queue(["Typeset",MathJax.Hub])});document.getElementById("btnEditDiscussion").addEventListener("click",function(event){if($("#edit-discussion-text").val()==""){showErrorMsg("Discussion text cannot be blank.");$("#edit-discussion-text").addClass("has-error");return}var div=$(this).parents(".discussion-post");var data=params;data["requestType"]="editComment";data["description"]=$("#edit-discussion-text").val();data["ctoken"]=$("#ctoken").val();data["utoken"]=$("#utoken").text();$.ajax({type:"POST",url:"/ajax/commentActions.php",data:data,dataType:"text",success:function(data){var response=JSON.parse(data);if(response.status=="success"){$(div).replaceWith(response.message);shortenDescription(".comment-desc")}else{showErrorMsg(response.message)}MathJax.Hub.Queue(["Typeset",MathJax.Hub])},error:function(response){console.log("Error")}})})});$("body").on("click",".deleteDiscussion",function(){var div=$(this).parents(".discussion-post");var data=params;data["requestType"]="deleteComment";data["iType"]="discussion";data["commentSlug"]=div.attr("data-slug");data["ctoken"]=$("#ctoken").val();data["utoken"]=$("#utoken").text();$.ajax({type:"POST",url:"/ajax/commentActions.php",data:data,dataType:"text",success:function(data){var response=JSON.parse(data);if(response.status=="success"){showErrorMsg(response.message);$(".discussion-list").click()}else{showErrorMsg(response.message)}},error:function(response){console.log("Error")}})});$("body").on("click",".markInappropriateDiscussion",function(){var div=$(this).parents(".discussion-post");var data=params;data["requestType"]="markInappropriateComment";data["iType"]="discussion";data["commentSlug"]=div.attr("data-slug");data["ctoken"]=$("#ctoken").val();data["utoken"]=$("#utoken").text();$.ajax({type:"POST",url:"/ajax/commentActions.php",data:data,dataType:"text",success:function(data){var response=JSON.parse(data);showErrorMsg(response.message)},error:function(response){console.log("Error")}})});$("body").on("click",".pinDiscussion",function(){var div=$(this).parents(".discussion-post");var data=params;data["requestType"]="pinDiscussion";data["iType"]="discussion";data["commentSlug"]=div.attr("data-slug");data["ctoken"]=$("#ctoken").val();data["utoken"]=$("#utoken").text();$.ajax({type:"POST",url:"/ajax/commentActions.php",data:data,dataType:"text",success:function(data){var response=JSON.parse(data);showErrorMsg(response.message);if(response.status=="success"){$(".comment-header").prepend('<span class="pinnedIcon"><i class="fa fa-thumb-tack"></i></span>');$(".pinDiscussion").parent().remove();$(".discussion-actions > .dropdown-menu").append('<li><a class="unpinDiscussion" style="cursor:pointer;">Unpin Discussion</a></li>')}},error:function(response){console.log("Error")}})});$("body").on("click",".unpinDiscussion",function(){var div=$(this).parents(".discussion-post");var data=params;data["requestType"]="unpinDiscussion";data["iType"]="discussion";data["commentSlug"]=div.attr("data-slug");data["ctoken"]=$("#ctoken").val();data["utoken"]=$("#utoken").text();$.ajax({type:"POST",url:"/ajax/commentActions.php",data:data,dataType:"text",success:function(data){var response=JSON.parse(data);showErrorMsg(response.message);if(response.status=="success"){$(".pinnedIcon").remove();$(".unpinDiscussion").parent().remove();$(".discussion-actions > .dropdown-menu").append('<li><a class="pinDiscussion" style="cursor:pointer;">Pin Discussion</a></li>')}},error:function(response){console.log("Error")}})});$("body").on("click",".markAsSolved",function(){var div=$(this).parents(".discussion-post");var data=params;data["requestType"]="markAsSolved";data["iType"]="discussion";data["commentSlug"]=div.attr("data-slug");data["ctoken"]=$("#ctoken").val();data["utoken"]=$("#utoken").text();$.ajax({type:"POST",url:"/ajax/commentActions.php",data:data,dataType:"text",success:function(data){var response=JSON.parse(data);showErrorMsg(response.message);if(response.status=="success"){$(".comment-header").append('<span class="markSolvedIcon"><i class="fas fa-check"></i></span>');$(".markAsSolved").remove();$(".lockInfo").remove();$(".disqusDiv").remove();if(response.require_feedback){$(".discussion-actions > .dropdown-menu").append('<li><a class="giveModeratorFeedback" style="cursor:pointer;">Give Feedback to Moderator</a></li>');getFeedbackForModerator($("#pickedByModeratorHandle").val())}}else if(response.status=="failed"){showErrorMsg(response.message);return false}},error:function(response){console.log("Error")}})});$("body").on("click",".editReply",function(){if($(this).parents(".reply-post").find(".reply-desc").find("#edit-reply-text").length)return;$(this).closest(".reply-post").find(".math-tex").each(function(index){$(this).html("\\("+$(this).find("script").html()+"\\)")});var div=$(this).parents(".reply-post").find(".reply-desc");var divHtml=div.html();var html='<div class="form-group pull-right"><a id="btnEditReplyClose" style="margin-right:5px;" class="btn btn-default btn-sm">Close</a><a id="btnEditReply" class="btn btn-primary btn-sm">Edit</a></div>';var editableText=$("<textarea/>").attr({cols:"20",id:"edit-reply-text"});editableText.val($(div).find(".complete_text").length?$(div).find(".complete_text").html():$(div).html());$(div).html(editableText);$(div).append(html);$(editableText).ckeditor({height:"150px",customConfig:"/ckeditor/custom_config-1.0.js?v=1.2",extraPlugins:"codesnippet,uploadimage,xml,textmatch,ajax,textwatcher,autocomplete,mentions,widget,lineutils,dialog,clipboard,mathjax"});document.getElementById("btnEditReplyClose").addEventListener("click",function(event){$(div).html(divHtml);MathJax.Hub.Queue(["Typeset",MathJax.Hub])});document.getElementById("btnEditReply").addEventListener("click",function(event){if($("#edit-reply-text").val()==""){showErrorMsg("Reply text cannot be blank.");$("#edit-reply-text").addClass("has-error");return}var div=$(this).parents(".reply-post");var replyId=$(div).attr("data-reply");var data=params;data["requestType"]="editReply";data["iType"]="discussion";data["replyId"]=replyId;data["replyText"]=$("#edit-reply-text").val();data["ctoken"]=$("#ctoken").val();data["utoken"]=$("#utoken").text();data["commentSlug"]=$(this).parents("#discussion-thread").find(".discussion-post").attr("data-slug");$.ajax({type:"POST",url:"/ajax/commentActions.php",data:data,dataType:"text",success:function(data){var response=JSON.parse(data);if(response.status=="success"){$(div).replaceWith(response.message);shortenDescription(".reply-desc")}else{showErrorMsg(response.message)}MathJax.Hub.Queue(["Typeset",MathJax.Hub])},error:function(response){console.log("Error")}})})});$("body").on("click",".deleteReply",function(){var div=$(this).parents(".reply-post");var replyId=$(div).attr("data-reply");var data=params;data["requestType"]="deleteReply";data["iType"]="discussion";data["replyId"]=replyId;data["ctoken"]=$("#ctoken").val();data["utoken"]=$("#utoken").text();$.ajax({type:"POST",url:"/ajax/commentActions.php",data:data,dataType:"text",success:function(data){var response=JSON.parse(data);if(response.status=="success"){$(div).remove();showErrorMsg(response.message);$(".reply-title").text(-1+parseInt($(".reply-title")[0].textContent)+" Replies")}else{showErrorMsg(response.message)}},error:function(response){console.log("Error")}})});$("body").on("click",".markAsSolution",function(){var div=$(this).parents(".reply-post");var replyId=$(div).attr("data-reply");var data=params;data["requestType"]="markUnmarkReplyAsSolution";data["iType"]="discussion";data["replyId"]=replyId;data["ctoken"]=$("#ctoken").val();data["utoken"]=$("#utoken").text();data["action"]="mark";$.ajax({type:"POST",url:"/ajax/commentActions.php",data:data,dataType:"text",success:function(data){var response=JSON.parse(data);if(response.status=="success"){showErrorMsg(response.message);fetchDiscussionHtml()}else{showErrorMsg(response.message)}},error:function(response){console.log("Error")}})});$("body").on("click",".unmarkAsSolution",function(){var div=$(this).parents(".reply-post");var replyId=$(div).attr("data-reply");var data=params;data["requestType"]="markUnmarkReplyAsSolution";data["iType"]="discussion";data["replyId"]=replyId;data["ctoken"]=$("#ctoken").val();data["utoken"]=$("#utoken").text();data["action"]="unmark";$.ajax({type:"POST",url:"/ajax/commentActions.php",data:data,dataType:"text",success:function(data){var response=JSON.parse(data);if(response.status=="success"){showErrorMsg(response.message);fetchDiscussionHtml()}else{showErrorMsg(response.message)}},error:function(response){console.log("Error")}})});$("body").on("click",".markInappropriateReply",function(){var div=$(this).parents(".reply-post");var replyId=$(div).attr("data-reply");var data=params;data["requestType"]="markInappropriateReply";data["iType"]="discussion";data["replyId"]=replyId;data["ctoken"]=$("#ctoken").val();data["utoken"]=$("#utoken").text();$.ajax({type:"POST",url:"/ajax/commentActions.php",data:data,dataType:"text",success:function(data){var response=JSON.parse(data);showErrorMsg(response.message)},error:function(response){console.log("Error")}})});var requestInitiated=0;$("body").on("click","#btnPostReply",function(e){if(requestInitiated==1){return false}e.preventDefault();if($("#reply-text").val()==""){showErrorMsg("Reply text cannot be blank.");$("#reply-text").closest(".form-group").addClass("has-error");return}if($("#commentAuthor").text().toLowerCase()==currentUser&&$(".markSolvedIcon").length){return false}$("#btnPostReply").text("Submitting..");var data=params;data["requestType"]="addNewReply";data["iType"]="discussion";data["reply"]=$("#reply-text").val();data["ctoken"]=$("#ctoken").val();data["resolutionStatusOptions"]=$("#resolutionStatusOptions").val();data["utoken"]=$("#utoken").text();data["commentSlug"]=$(this).parents("#discussion-thread").find(".discussion-post").attr("data-slug");var commentId=$(this).parents("#discussion-thread").find(".discussion-post").attr("discussion");var itemId=$(this).parents("#discussion-thread").find(".discussion-post").attr("item-id");var author_room=$(this).parents("#discussion-thread").find(".discussion-post").attr("author-room");var commentParentType=$(this).parents("#discussion-thread").find(".discussion-post").data("parent-type");$("#btnPostReply").prop("disabled",true);requestInitiated=1;$.ajax({type:"POST",url:"/ajax/commentActions.php",data:data,dataType:"text",success:function(result){requestInitiated=0;var response=JSON.parse(result);if(response.status=="success"){var room="";if(pageSource=="batch"||pageSource=="problems"){room=[wsRoom,"comment_"+commentId]}else if(pageSource=="thread_page"){room=[commentParentType+"_"+itemId,wsRoom,author_room]}if(room!=""){sendMessageToSocket("addReply",{roomId:room,commentId:commentId,reply:response.data,commentSlug:data["commentSlug"],byAuthor:response.byAuthor})}if($("#reply-feed .reply-post").length){$("#reply-feed .reply-post:last").after(response.reply)}else{$("#reply-feed #replies-section").append(response.reply);$("#replies-section").css("display","block")}$("#replies-section").animate({scrollTop:1e4},"slow");$("#reply-text").val("");CKEDITOR.instances["reply-text"].on("key",function(e){if(e.data.keyCode=="13"){if($("#reply-text").val()==""){return false}$("#btnPostReply").click()}else{if(pageSource=="batch"||pageSource=="problems"){var commentId=$("#discussion-thread").find(".discussion-post").attr("discussion");if(commentId!=undefined){var roomId="comment_"+commentId;sendMessageToSocket("typing",{roomId:roomId,commentId:commentId})}}else if(pageSource=="thread_page"){var author_room=$(this).parents("#discussion-thread").find(".discussion-post").attr("author-room");sendMessageToSocket("threadPageTyping",{roomId:author_room})}}});MathJax.Hub.Queue(["Typeset",MathJax.Hub]);shortenDescription(".reply-desc");$(".reply-desc").find("img").each(function(){if(!$(this).hasClass("img-responsive"))$(this).addClass("img-responsive")});if(response.resolved=="0"){$(".markSolvedIcon").remove();$(".markAsUnresolved").parent().remove();$(".discussion-actions > .dropdown-menu").append('<li><a class="markAsSolved" style="cursor:pointer;">Mark As Solved</a></li>')}$(".reply-title").text(1+parseInt($(".reply-title")[0].textContent)+" Replies")}else{showErrorMsg(response.message)}},error:function(response){console.log("Error");requestInitiated=0},complete:function(response){requestInitiated=0;$("#btnPostReply").text("Submit");$("#btnPostReply").prop("disabled",false)}})});$("body").on("click",".markAsNonTech",function(){var div=$(this).parents(".discussion-post");var data=params;data["requestType"]="markAsNonTech";data["iType"]="discussion";data["commentSlug"]=div.attr("data-slug");data["ctoken"]=$("#ctoken").val();data["utoken"]=$("#utoken").text();$.ajax({type:"POST",url:"/ajax/commentActions.php",data:data,dataType:"text",success:function(data){var response=JSON.parse(data);if(response.status=="SUCCESS"){showErrorMsg(response.message);if($("body").find(".releaseComment").length>0){$(".releaseComment").click()}fetchDiscussionHtml()}},error:function(response){showErrorMsg(response.message)}})});$("body").on("click",".pickComment",function(e){e.preventDefault();var data=params;var attr=$(this).parent().parent().attr("itype");var isBatchPage=typeof currentBatchId!="undefined"&&currentBatchId>0?true:false;if(attr!=undefined&&attr!=false){data["iType"]=attr;console.log(attr)}else if($(this).hasClass("singleDiscussion")){data["iType"]="discussion"}else if(isBatchPage){data["iType"]="batch"}else{data["iType"]="discussion"}data["iId"]=$(this).parents(".discussion-post").attr("item-id");data["requestType"]="pickComment";data["commentSlug"]=$(this).parents(".discussion-post").attr("data-slug");data["ctoken"]=$("#ctoken").val();data["utoken"]=$("#utoken").text();var thisParent=$(this).parent();$(this).html("Aquiring Lock <i class='fas fa-spinner fa-spin'></i>");var curButton=$(this);$.ajax({type:"POST",url:"/ajax/commentActions.php",data:data,dataType:"text",success:function(data){var response=JSON.parse(data);if(response.status=="success"){curButton.html("Acquired");thisParent.addClass("wsal");var id=curButton.parents(".discussion-post").attr("item-id");var author_room=curButton.parents(".discussion-post").attr("author-room");var doubtId=curButton.parents(".discussion-post").attr("discussion");var doubtSlug=curButton.parents(".discussion-post").attr("data-slug");var doubtEle1=$("[discussion="+doubtId+"]").find(".discussion-title a");var doubtEle2=$("[discussion="+doubtId+"]").find(".discussion-title span");var doubtEle3=$("[discussion="+doubtId+"]").find(".comment-title");var doubtTitle="";if(doubtEle1.length>0){doubtTitle=doubtEle1.text()}if(doubtEle2.length>0){doubtTitle=doubtEle2.text()}if(doubtEle3.length>0){doubtTitle=doubtEle3.text()}var room="";var extraData={};if(pageSource=="all_discussions"){var mode=$(".discussion-type option:selected").val();room=[mode+"_"+id,"comment_"+doubtId,author_room]}else if(pageSource=="batch"||pageSource=="problems"){room=[wsRoom,"comment_"+doubtId]}else if(pageSource=="thread_page"){mode=$("[discussion="+doubtId+"]").data("parent-type");room=[mode+"_"+id,"comment_"+doubtId,author_room]}extraData={pickedAt:response.pickedAt};var dd={type:"doubtPicked",id:id,doubtId:doubtId,doubtSlug:doubtSlug,author:response.author,pickedBy:response.handle,doubtTitle:doubtTitle,roomId:room,extraData:extraData};sendMessageToSocket("doubtPicked",dd);if(curButton.hasClass("singleDiscussion")){params.iId=id;params.iType="discussion";params.page=1;fetchDiscussionHtml()}else{if(params.discussionPage){var slug=curButton.parents(".discussion-post").attr("data-slug");window.open("/discussion/"+id+"/"+slug+"/","_blank")}else{curButton.parents(".discussion-post").find(".discussion-title").click()}}}else{showErrorMsg(response.message)}},error:function(response){console.log("Error")},complete:function(response){}})});$("body").on("click",".releaseComment, .forceReleaseLock",function(e){e.preventDefault();var data=params;data["requestType"]="releaseComment";data["commentSlug"]=$(this).parents(".discussion-post").attr("data-slug");data["iType"]="discussion";data["iId"]=$(this).parents(".discussion-post").attr("item-id");data["ctoken"]=$("#ctoken").val();data["utoken"]=$("#utoken").text();var curButton=$(this);$(this).html("Releasing <i class='fas fa-spinner fa-spin'></i>");$.ajax({type:"POST",url:"/ajax/commentActions.php",data:data,dataType:"text",success:function(data){var response=JSON.parse(data);if(response.status=="success"){if(response.resolutionStatus==0){let acquireLockHtml='<a class="pickComment singleDiscussion">Acquire Lock</a>';$(".lockInfo").html(acquireLockHtml);curButton.parents().closest("span").siblings(".wsal").html(acquireLockHtml)}if($("body").find("#resolutionStatusOptions").length>0){$("#resolutionStatusOptions").hide()}if($("body").find(".markAsSolution").length>0){$(".markAsSolution").hide()}if($("body").find(".unmarkAsSolution").length>0){$(".unmarkAsSolution").hide()}if(response.self==true){$(".disqusDiv").hide()}$("#btnPostReply").text("Submit");curButton.hide();var commentId=curButton.parents(".discussion-post").attr("discussion");var itemId=curButton.parents(".discussion-post").attr("item-id");var parentType=curButton.parents(".discussion-post").data("parent-type");var author_room=curButton.parents(".discussion-post").attr("author-room");var doubtSlug=curButton.parents(".discussion-post").attr("data-slug");var room=["comment_"+commentId,parentType+"_"+itemId,author_room];var dd={type:"releaseComment",id:itemId,doubtId:commentId,doubtSlug:doubtSlug,roomId:room};sendMessageToSocket("releaseComment",dd)}else{showErrorMsg(response.message);curButton.text("Release Lock")}},error:function(response){console.log("Error")},complete:function(response){}})});$("body").on("click",".giveModeratorFeedback",function(){getFeedbackForModerator($("#pickedByModeratorHandle").val())});$("body").on("click","#submitFeedback",function(){let emojiRatingITags=$(".emojiRating");let ratingValue=undefined;let feedBack=$("#feedbackContent").val();for(let i=1;i<=emojiRatingITags.length;i+=1){if(emojiRatingITags[i-1].getAttribute("value")=="1"){ratingValue=i;break}}if(!ratingValue){showErrorMsg("Please rate in between 1 to 5");return}if(ratingValue<=3&&(!feedBack||feedBack.trim().length<50)){showErrorMsg("Please give us your valuable feedback (minimum 50 characters)");return}var div=$(".discussion-post");var data=params;data["iType"]="discussion";data["ctoken"]=$("#ctoken").val();data["utoken"]=$("#utoken").text();data["requestType"]="rateModeratorAndGiveFeedback";data["commentSlug"]=div.attr("data-slug");data["moderatorRating"]=ratingValue;data["moderatorFeedback"]=$("#feedbackContent").val();$.ajax({type:"POST",url:"/ajax/commentActions.php",data:data,dataType:"text",success:function(data){var response=JSON.parse(data);showErrorMsg(response.message);if(response.status=="success"){$("#moderatorFeedbackModal").hide();$(".giveModeratorFeedback").parent().remove()}},error:function(response){console.log("Error")}})});$("body").on("click","#moderatorFeedbackModal .close",function(){$("#moderatorFeedbackModal").hide()});$("body").on("click","#moderatorFeedbackModal.modal",function(event){if(event.target.id=="moderatorFeedbackModal")$("#moderatorFeedbackModal").hide()});function setEventOnEditor(e){e.editor.document.on("keypress",function(){if(pageSource=="batch"||pageSource=="problems"){var commentId=$("#discussion-thread").find(".discussion-post").attr("discussion");if(commentId!=undefined){var roomId="comment_"+commentId;sendMessageToSocket("typing",{roomId:roomId,commentId:commentId})}}else if(pageSource=="thread_page"){var author_room=$(".discussion-post").attr("author-room");sendMessageToSocket("threadPageTyping",{roomId:author_room})}});e.editor.on("key",function(e){if(e.data.keyCode=="13"){if($("#reply-text").val()==""){return false}$("#btnPostReply").click()}})}CKEDITOR.on("instanceCreated",function(e){e.editor.on("contentDom",function(){setEventOnEditor(e)})})});