var paymentGfgJs={gfgPay:"#gfgPay",insertBeforeSelector:$("footer").length?"footer":"#gfgPay",ptype:"",practiceApiHost:"",pslug:"",payNow:".gfg-paynow",gfgPaymentConfirm:"#gfg-payment-confirm",gateway:"",transactionToken:"",loaderHtml:'<i class="fas fa-spinner fa-spin"></i>',init:function(){var _self=this;$("body").on("click",_self.gfgPay,function(event){_self.fetchDetails()});$("body").on("click",_self.payNow,function(event){_self.createOrder(this)});$("body").on("click",".gfgpay-close",function(event){$(_self.gfgPaymentConfirm).modal("hide");setTimeout(function(){$(_self.gfgPaymentConfirm).remove()},200)});$("#commentModal").on("hidden.bs.modal",function(){$(".modal-backdrop").remove()})},removeGfgPaymentDetailsModal(){var _self=this;$(_self.gfgPaymentConfirm).remove()},fetchDetails:function(){var _self=this;$(_self.gfgPay).prop("disabled",true);$.ajax({type:"GET",url:_self.practiceApiHost+"payment/fetch/?pslug="+_self.pslug+"&ptype="+_self.ptype,crossDomain:true,xhrFields:{withCredentials:true},success:function(response){if(response.hasOwnProperty("results")){response=response.results;if(response.is_eligible==true){_self.removeGfgPaymentDetailsModal();$(_self.fetchPaymentModalHtml()).insertBefore(_self.insertBeforeSelector);$(_self.gfgPaymentConfirm+" .modal-title").text(response.title);$(_self.gfgPaymentConfirm+" #total-amount").text(response.symbol+" "+response.batch_fee);_self.transactionToken=response.transaction_token;_self.gateway=response.gateway;if(response.is_indian_ip==false){$("#payContainer").html('<div class="row justify-content-center"> <div id="paypal-button-container" class="col-sm-offset-3 col-sm-6"> </div> </div>')}$(_self.gfgPaymentConfirm).modal("show")}else{alert("No you are not eligible for payment")}}else if(response.hasOwnProperty("error")){alert(response.error.message)}else{alert("Something went wrong")}},error:function(jqxhr,textStatus,errorThrown){},complete:function(jqxhr,textStatus,errorThrown){$(_self.gfgPay).prop("disabled",false);if(textStatus=="error"){alert("Something went wrong");return false}}})},createOrder:function(obj){var _self=this;if($("#paypal-button-container").length){_self.paypalCreateOrder()}else{_self.razorPayCreateOrder(obj);$(obj).prop("disabled","true")}},paypalCreateOrder:function(){var _self=this;$(_self.payNow).hide();paypal.Buttons({style:{color:"silver",layout:"horizontal"},createOrder:function(){return fetch(_self.practiceApiHost+"payment/create-order/",{method:"post",body:JSON.stringify({transaction_token:_self.transactionToken,gateway:_self.gateway}),credentials:"include",headers:{"Content-Type":"application/json"}}).then(function(res){return res.json()}).then(function(data){if(data.status=="error"){$("#gfg-payment-confirm").modal("hide");setTimeout(function(){$("#gfg-payment-confirm").remove()},200);displayError("","",data.error.message)}else{return data.message.order_id}}).catch(error=>{console.log(error)})},onApprove:function(data){var _self=this;console.log("onapprove js log");$("#gfg-payment-confirm").modal("hide");setTimeout(function(){$("#gfg-payment-confirm").remove()},300);paymentGfgJs.verifyPayment(data,"paypal")},onCancel:function(data){$("#gfg-payment-confirm").modal("hide");setTimeout(function(){$("#gfg-payment-confirm").remove()},300);$("#commentModal .modal-body").html('<i class="fas fa-info-circle" style="font-size:75px; color:#e53931"></i><br> <h4 style="color:#ea5049;">Your payment could not be processed.</h4><p>We\'ll re-verify your payment and update the status soon. Please try after some time. If your account was debited, the amount will be refunded within a week.</p>');$("#commentModal").modal("show");$("#commentModal div.modal-footer button").removeClass("btn-default");$("#commentModal div.modal-footer button").addClass("btn-success")},onError:function(err){$("#gfg-payment-confirm").modal("hide");setTimeout(function(){$("#gfg-payment-confirm").remove()},300);$("#commentModal .modal-body").html('<i class="fas fa-info-circle" style="font-size:75px; color:#e53931"></i><br> <h4 style="color:#ea5049;">Your payment could not be processed.</h4><p> Please try after some time. If your account was debited, the amount will be refunded within a week.</p>');$("#commentModal").modal("show");$("#commentModal div.modal-footer button").removeClass("btn-default");$("#commentModal div.modal-footer button").addClass("btn-success");console.log(err)}}).render("#paypal-button-container")},razorPayCreateOrder:function(obj){var _self=this;$(obj).prop("disabled","true");$(_self.payNow).html("Processing <i class='fa fa-spin fa-spinner'></i>");$.ajax({type:"POST",url:_self.practiceApiHost+"payment/create-order/",crossDomain:true,data:{gateway:_self.gateway,transaction_token:_self.transactionToken},xhrFields:{withCredentials:true},success:function(response){if(response.hasOwnProperty("status")&&response.status=="success"){if(response.message==null){alert("Something went wrong");return false}_self.showRazorPayGateway(response.message);setTimeout(function(){$(_self.gfgPaymentConfirm).remove()},200);$(_self.gfgPaymentConfirm).hide()}else if(response.hasOwnProperty("status")&&response.status=="error"){alert(response.message);$(_self.gfgPaymentConfirm).hide()}else{alert("Please reload the page and try again.")}},error:function(){$(_self.gfgPaymentConfirm).hide()}})},showRazorPayGateway:function(data){var _self=this;var html='<button id="rzp-pay-button" class="btn btn-success" style="border-radius:0.3rem">Pay Now</button>';$(_self.gfgPaymentConfirm).find(".modal-footer").html(html);var options={key:data.key,amount:data.amount,name:"GeeksForGeeks",description:data.description,order_id:data.order_id,handler:function(response){paymentGfgJs.verifyPayment(response)},modal:{ondismiss:function(){_self.removeGfgPaymentDetailsModal();$("#commentModal .modal-body").html('<i class="fas fa-info-circle" style="font-size:75px; color:#e53931"></i><br> <h4 style="color:#ea5049;">Your payment could not be processed.</h4><p>We\'ll re-verify your payment and update the status soon. Please try after some time. If your account was debited, the amount will be refunded within a week.</p>');$("#commentModal").modal("show");$("#commentModal div.modal-footer button").removeClass("btn-default");$("#commentModal div.modal-footer button").addClass("btn-success")}},prefill:{name:data.uname,email:data.uemail,contact:data.contact},notes:{goi:data.gfg_order_id}};var rzp1=new Razorpay(options);document.getElementById("rzp-pay-button").onclick=function(e){rzp1.open();e.preventDefault()};$("#rzp-pay-button").trigger("click")},verifyPayment:function(response,gateway="razorpay"){var _self=this;$('<div id="gfgpay-loading-wrap" class="text-center" style="position:fixed; height:100%;  width:100%;  top:0; left:0;background-color: #6cd27f24;padding: 10% 30% 30% 25%;"> <h3> <i class="fa fa-pulse fa-spinner" style="font-size: 75px;"></i><br>Processing... <br> Please do not Refresh/Close this tab.</h3></div>').insertBefore(_self.insertBeforeSelector);var requestData={gateway:gateway,gateway_order_id:response.orderID};if(gateway=="razorpay"){requestData["razorpay_payment_id"]=response.razorpay_payment_id;requestData["razorpay_order_id"]=response.razorpay_order_id;requestData["gateway_order_id"]=response.razorpay_order_id;requestData["razorpay_signature"]=response.razorpay_signature}$.ajax({type:"POST",url:_self.practiceApiHost+"payment/verify-payment/",crossDomain:true,data:requestData,xhrFields:{withCredentials:true},success:function(response){if(response.hasOwnProperty("status")&&response.status=="SUCCESS"){gtag("event","conversion",{send_to:"AW-796001856/DLCZCKWT4qkBEMCMyPsC"});$(".modal-backdrop").remove();_self.paymentCompleteModal(response.message);$("#gfg-tran-completed").modal("show");$("#dsBuyBlock").remove();$("#ds-note").remove();location.reload()}else if(response.hasOwnProperty("status")&&response.status=="error"){_self.displayError("","",response.message)}else{alert("Please reload the page and try again.")}},error:function(jqXHR,exception){_self.displayError(jqXHR,exception,"")},complete:function(){$("#gfgpay-loading-wrap").remove()}})},displayError:function(jqXHR,exception,msg){if(msg!=""){}else if(jqXHR.status===0){msg="Can't connect.\n Check your internet connection."}else if(jqXHR.status==404){msg="Requested page not found. [404]"}else if(jqXHR.status==500){msg="Internal Server Error [500]."}else if(exception==="parsererror"){msg="Requested JSON parse failed."}else if(exception==="timeout"){msg="Time out error."}else if(exception==="abort"){msg="Ajax request aborted."}else{msg="Uncaught Error.\n"+jqXHR.responseText}$("#gfg-snackbar").text(msg);$("#gfg-snackbar").addClass("show");setTimeout(function(){$("#gfg-snackbar").removeClass("show")},6e3)},paymentCompleteModal:function(content){var _self=this;var html='<div class="modal fade" id="gfg-tran-completed" role="dialog">';html+='<div class="modal-dialog"><div class="modal-content">';html+='<div class="modal-header">';html+='<button type="button" class="close gfgpay-close" data-dismiss="modal">&times;</button>';html+='<h4 class="modal-title">Transaction Status</h4></div>';html+='<div class="modal-body"><div style="text-align: center;" id="payment-complete-modal-body">'+content+"</div>";html+='</div><div class="modal-footer" style="text-align:center;"></div></div></div></div>';$(html).insertBefore(_self.insertBeforeSelector)},fetchPaymentModalHtml(){var _self=this;var html='<div class="modal fade" id="gfg-payment-confirm" role="dialog" style="display:none;">';html+='<div class="modal-dialog"><div class="modal-content"><div class="modal-header">';html+='<button type="button" class="close gfgpay-close" data-dismiss="modal">&times;</button>';html+='<h4 class="modal-title"></h4></div><div class="modal-body"><div style="margin-left: 10%;">';html+='<table class="table" style="max-width:80%; margin-bottom:0px !important" >';html+='<thead><tr style="border:none"><strong style="margin-left:10px;">Price Details </strong></tr></thead>';html+='<tbody><tr><td style="border:none"> Price: <small>(inclusive of all taxes)  </small></td>';html+='<td style="border:none;min-width: 65px;" id="total-amount"></td></tr><tr>';html+='<td colspan="2" style="border:none"></td></tr></tbody></table><div class="modal-footer" style="text-align:center;">';html+='<form><button type="button" class="btn btn-success gfg-paynow" style="border-radius: 0.3rem;">Proceed to Pay</button>';html+='</form><div id="payContainer"></div><br><small style="text-align:center">';html+='BY CONFIRMING YOU AGREE TO OUR <a href="/terms-of-service" target="_blank">TERMS OF SERVICE</a></small></div></div>';html+="</div></div></div></div>";return html}};